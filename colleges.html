<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Colleges | Pathfinder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    :root{
      --bg:#0e0e0e; --panel:#1a1a1a; --line:#2a2a2a; --text:#e0e0e0; --muted:#b0b7c8; --accent:#82b1ff;
      --ok:#1ed760; --warn:#ffcc00; --danger:#ff5c5c;
    }
    body{font-family:'Outfit',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{color:#cfe1ff;text-decoration:none} a:hover{color:#fff}

    /* nav */
    header{position:sticky;top:0;z-index:5;background:#111;border-bottom:1px solid #333}
    .nav{max-width:1100px;margin:0 auto;padding:15px 20px;display:flex;justify-content:space-between;align-items:center}
    .brand{font-weight:700;color:var(--accent)}
    .links a{color:#82b1ff;margin:0 12px;font-weight:700}
    .links a:hover{color:#fff}
    .links a.active{color:#fff;border-bottom:2px solid var(--accent)}

    main{max-width:1100px;margin:40px auto;padding:0 20px}
    h1{font-size:2.0rem;color:var(--accent);text-shadow:0 0 5px #82b1ff;margin-bottom:8px}
    .lead{color:#aaa;margin-bottom:16px}

    .panel{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:16px}
    .grid{display:grid;gap:12px}
    @media(min-width:860px){.grid{grid-template-columns:2fr 2fr 1fr 1fr}}

    label{display:block;font-size:13px;color:#b7bed2;margin-bottom:6px}
    input,select,button{width:100%;padding:14px;border-radius:10px;border:1px solid #444;background:#1b1b1b;color:var(--text);font-size:1rem}
    input:focus,select:focus,button:focus{outline:none;border-color:#3b72c7;box-shadow:0 0 0 3px rgba(130,177,255,.15)}
    button{cursor:pointer;font-weight:700;background:#1c2740} button:hover{filter:brightness(1.05)}

    .legend{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 0}
    .tag{font-size:12px;padding:6px 9px;border-radius:999px;border:1px solid #00000022;display:inline-block}
    .safety{background:rgba(30,215,96,.15);color:#a6f0bf;border-color:rgba(30,215,96,.35)}
    .target{background:rgba(255,204,0,.12);color:#ffe08a;border-color:rgba(255,204,0,.35)}
    .reach{background:rgba(255,92,92,.14);color:#ffb6b6;border-color:rgba(255,92,92,.35)}

    .count{color:#b7bed2;font-size:14px;margin:16px 2px}

    .table-wrap{overflow:auto;border-radius:12px;border:1px solid var(--line)}
    table{width:100%;border-collapse:separate;border-spacing:0}
    thead th{text-align:left;font-size:12px;letter-spacing:.05em;text-transform:uppercase;color:#aeb7cb;background:#161616;padding:10px 12px;border-bottom:1px solid var(--line);position:sticky;top:0;z-index:1}
    tbody td{padding:14px 12px;border-bottom:1px solid #1f1f1f}
    tbody tr:hover{background:#141414}

    .footnote{color:#9aa4b9;font-size:12px;margin-top:8px}
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="brand">Pathfinder</div>
      <div class="links">
        <a href="index.html">Home</a>
        <a href="explore.html">Explore</a>
        <a href="colleges.html" class="active">Colleges</a>
      </div>
    </div>
  </header>

  <main>
    <h1>Find Colleges by GPA & Major</h1>
    <p class="lead">Type your weighted GPA, pick a major, and (optionally) filter. Results update instantly.</p>

    <section class="panel" aria-label="Filters">
      <div class="grid">
        <div>
          <label for="gpa">Weighted GPA</label>
          <!-- text+decimal prevents browser spinner + lets you type freely -->
          <input id="gpa" type="text" inputmode="decimal" placeholder="e.g., 4.10">
        </div>
        <div>
          <label for="major">Major</label>
          <input list="majors" id="major" placeholder="Start typing…">
          <datalist id="majors"></datalist>
        </div>
        <div>
          <label for="system">System</label>
          <select id="system">
            <option value="ALL">All</option>
            <option value="UC">UC</option>
            <option value="CSU">CSU</option>
            <option value="Private">Private</option>
          </select>
        </div>
        <div>
          <label for="minrate">Min admit rate</label>
          <select id="minrate">
            <option value="0">Any</option>
            <option value="10">≥ 10%</option>
            <option value="20">≥ 20%</option>
            <option value="30">≥ 30%</option>
          </select>
        </div>
      </div>

      <div class="legend">
        <span class="tag safety">Safety</span>
        <span class="tag target">Target</span>
        <span class="tag reach">Reach</span>
      </div>
    </section>

    <section style="margin-top:14px">
      <div class="count" id="count">No results yet.</div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>College</th>
              <th>System</th>
              <th>Fit</th>
              <th>Midpoint GPA</th>
              <th>Admit rate</th>
              <th>Links</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
      <p class="footnote">Tip: share <code>?gpa=4.12&major=Civil%20Engineering</code> to prefill.</p>
    </section>
  </main>

  <script>
    /* ---------- Data (small, human-sized) ---------- */
    const MAJORS = [
      "Civil Engineering","Mechanical Engineering","Electrical Engineering","Materials Science",
      "Computer Science","Mathematics","Psychology","Business Administration","Finance","Nursing","Liberal Arts"
    ];

    const COLLEGES = [
      {name:"UC Berkeley", system:"UC", midGpa:4.25, admitRate:12, majors:["Civil Engineering","Mechanical Engineering","Electrical Engineering","Computer Science","Mathematics","Materials Science","Liberal Arts"], midByMajor:{"Civil Engineering":4.28,"Electrical Engineering":4.28,"Computer Science":4.30,"Mathematics":4.18,"Liberal Arts":4.08}},
      {name:"UCLA", system:"UC", midGpa:4.23, admitRate:11, majors:["Civil Engineering","Mechanical Engineering","Electrical Engineering","Computer Science","Psychology","Mathematics","Liberal Arts"], midByMajor:{"Civil Engineering":4.26,"Electrical Engineering":4.26,"Computer Science":4.29,"Psychology":4.15,"Mathematics":4.17,"Liberal Arts":4.05}},
      {name:"UC San Diego", system:"UC", midGpa:4.15, admitRate:24, majors:["Civil Engineering","Mechanical Engineering","Electrical Engineering","Computer Science","Mathematics","Materials Science","Liberal Arts"], midByMajor:{"Computer Science":4.22,"Electrical Engineering":4.18,"Mathematics":4.06,"Liberal Arts":3.98}},
      {name:"UC Santa Barbara", system:"UC", midGpa:4.10, admitRate:26, majors:["Mechanical Engineering","Computer Science","Mathematics","Psychology","Liberal Arts"], midByMajor:{"Mechanical Engineering":4.16,"Computer Science":4.14,"Mathematics":4.02,"Liberal Arts":3.95}},
      {name:"UC Irvine", system:"UC", midGpa:4.08, admitRate:28, majors:["Civil Engineering","Mechanical Engineering","Electrical Engineering","Computer Science","Business Administration","Nursing","Liberal Arts"], midByMajor:{"Nursing":4.20,"Computer Science":4.14,"Electrical Engineering":4.06,"Business Administration":3.98,"Liberal Arts":3.90}},
      {name:"Cal Poly SLO", system:"CSU", midGpa:4.05, admitRate:29, majors:["Civil Engineering","Mechanical Engineering","Materials Science","Business Administration","Computer Science","Mathematics","Liberal Arts"], midByMajor:{"Computer Science":4.10,"Mechanical Engineering":4.08,"Civil Engineering":4.10,"Liberal Arts":3.85}},
      {name:"San Diego State", system:"CSU", midGpa:3.90, admitRate:38, majors:["Civil Engineering","Mechanical Engineering","Electrical Engineering","Computer Science","Business Administration","Nursing","Mathematics","Liberal Arts"], midByMajor:{"Nursing":4.00,"Computer Science":3.95}},
      {name:"USC", system:"Private", midGpa:4.15, admitRate:12, majors:["Business Administration","Computer Science","Mechanical Engineering","Electrical Engineering","Mathematics","Liberal Arts"], midByMajor:{"Business Administration":4.05,"Computer Science":4.18}},
      {name:"Stanford", system:"Private", midGpa:4.30, admitRate:4, majors:["Computer Science","Mathematics","Electrical Engineering","Liberal Arts"], midByMajor:{"Computer Science":4.33,"Mathematics":4.25}}
    ];

    /* ---------- DOM ---------- */
    const majorsDL = document.getElementById('majors');
    MAJORS.forEach(m => majorsDL.insertAdjacentHTML('beforeend', `<option value="${m}">`));

    const gpaEl   = document.getElementById('gpa');
    const majorEl = document.getElementById('major');
    const sysEl   = document.getElementById('system');
    const minEl   = document.getElementById('minrate');
    const rowsEl  = document.getElementById('rows');
    const countEl = document.getElementById('count');

    /* ---------- Helpers ---------- */
    const ALIASES = {
      "civ eng":"civil engineering",
      "mech eng":"mechanical engineering",
      "ee":"electrical engineering",
      "mat sci":"materials science",
      "comp sci":"computer science",
      "cs":"computer science",
      "biz":"business administration"
    };

    function normalizeMajor(s){
      if(!s) return "";
      const low = String(s).trim().toLowerCase();
      return ALIASES[low] || low; // always lower
    }

    function majorsContains(list, wantedLow){
      if(!wantedLow) return true; // no filter
      return (list||[]).some(x => x.toLowerCase() === wantedLow);
    }

    function parseGpaLoose(str){
      if (str == null) return NaN;
      const cleaned = String(str).replace(',', '.').trim();
      const v = parseFloat(cleaned);
      if (isNaN(v)) return NaN;
      return Math.max(0, Math.min(5, v));
    }
    function formatGpa(v){ return isNaN(v) ? "" : v.toFixed(2); }

    function getMidpoint(college, majorLow){
      if (majorLow && college.midByMajor){
        for (const k in college.midByMajor){
          if (k.toLowerCase() === majorLow) return college.midByMajor[k];
        }
      }
      return college.midGpa;
    }

    function classify(gpa, mid){
      if (isNaN(gpa) || isNaN(mid)) return {band:"—"};
      const diff = +(gpa - mid).toFixed(2);
      if (diff >= 0.20) return {band:"Safety", diff};
      if (Math.abs(diff) <= 0.15) return {band:"Target", diff};
      return {band:"Reach", diff};
    }
    const fitClass = b => b==="Safety"? "safety" : b==="Target" ? "target" : "reach";
    const admissionsUrl = name => `https://www.google.com/search?q=${encodeURIComponent(name+' undergraduate admissions')}`;

    /* ---------- Core ---------- */
    function analyze(){
      const g = parseGpaLoose(gpaEl.value);
      const majorLow = normalizeMajor(majorEl.value);
      const system = sysEl.value;
      const minRate = parseInt(minEl.value, 10) || 0;

      const items = COLLEGES
        .filter(c => (system === "ALL" ? true : c.system === system))
        .filter(c => c.admitRate >= minRate)
        .filter(c => majorsContains(c.majors, majorLow))
        .map((c, i) => {
          const mid = getMidpoint(c, majorLow);
          const fit = classify(g, mid);
          return { id:i, name:c.name, system:c.system, mid, rate:c.admitRate, fit };
        });

      const rank = b => b==="Safety"?0 : b==="Target"?1 : b==="Reach"?2 : 3;
      items.sort((a,b)=> rank(a.fit.band)-rank(b.fit.band) || a.mid-b.mid);

      render(items);
    }

    function render(items){
      rowsEl.innerHTML = "";
      if (!items.length){
        countEl.textContent = "No results yet. Enter GPA and choose a major.";
        return;
      }
      const tally = items.reduce((acc,r)=>{ acc[r.fit.band]=(acc[r.fit.band]||0)+1; return acc; },{});
      countEl.textContent = `${items.length} result${items.length===1?"":"s"} — ${tally.Safety||0} Safety • ${tally.Target||0} Target • ${tally.Reach||0} Reach`;

      const frag = document.createDocumentFragment();
      items.forEach(r=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${r.name}</td>
          <td>${r.system}</td>
          <td><span class="tag ${fitClass(r.fit.band)}">${r.fit.band}</span></td>
          <td>${isFinite(r.mid) ? r.mid.toFixed(2) : "—"}</td>
          <td>${r.rate}%</td>
          <td><a href="${admissionsUrl(r.name)}" target="_blank" rel="noopener">Admissions</a></td>
        `;
        frag.appendChild(tr);
      });
      requestAnimationFrame(()=>rowsEl.appendChild(frag));
    }

    /* ---------- Events (debounced; don’t format while typing) ---------- */
    function debounce(fn,ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); }; }
    const run = debounce(analyze, 140);

    [gpaEl, majorEl, sysEl, minEl].forEach(el=>{
      el.addEventListener('input', run);
      el.addEventListener('change', run);
      el.addEventListener('keydown', e=>{
        if(e.key==='Enter'){
          e.preventDefault();
          const val = parseGpaLoose(gpaEl.value);
          if (!isNaN(val)) gpaEl.value = formatGpa(val);
          analyze();
        }
      });
    });

    // Format GPA when leaving the field (never during typing)
    gpaEl.addEventListener('blur', ()=>{
      const val = parseGpaLoose(gpaEl.value);
      gpaEl.value = formatGpa(val);
    });

    // Init from URL (?gpa=&major=)
    (function init(){
      const p = new URL(location.href).searchParams;
      const qpG = p.get('gpa'); const qpM = p.get('major');
      if (qpG) gpaEl.value = qpG;
      if (qpM) majorEl.value = qpM;
      if (!gpaEl.value) gpaEl.value = "4.00";
      analyze();
    })();
  </script>
</body>
</html>
